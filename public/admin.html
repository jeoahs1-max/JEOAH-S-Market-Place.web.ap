<!DOCTYPE html>\n<html lang=\"fr\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Tableau de Bord - Admin - JEOAH\'S</title>\n\n    <!-- META SEO & OPEN GRAPH -->\n    <meta name=\"robots\" content=\"noindex, nofollow\"> \n\n    <!-- Firebase SDK -->\n    <script src=\"https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js\"></script>\n    <script src=\"https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js\"></script>\n    <script src=\"https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js\"></script>\n\n    <!-- Config & Styles -->\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css\" />\n    <link rel=\"icon\" href=\"/assets/logo.png\" type=\"image/png\">\n\n    <style>\n        body { font-family: \'Inter\', sans-serif; background-color: #f3f4f6; }\n        .widget { background-color: white; border-radius: 1rem; box-shadow: 0 4px_6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); padding: 1.5rem; margin-bottom: 2rem; }\n        .widget-title { font-size: 1.25rem; font-weight: 700; color: #1f2937; }\n    </style>\n</head>\n<body class=\"flex flex-col min-h-screen\">\n\n    <!-- Header -->\n    <header class=\"bg-white shadow-md sticky top-0 z-50\">\n        <nav class=\"container mx-auto px-6 py-4 flex justify-between items-center\">\n            <a href=\"index.html\" class=\"flex items-center text-2xl font-extrabold text-gray-900\">\n                <img src=\"/assets/logo.png\" alt=\"JEOAH\'S Logo\" class=\"h-8 mr-3\">\n                <span>Tableau de Bord Admin</span>\n            </a>\n            <div>\n                <span id=\"user-greeting\" class=\"text-gray-700 font-semibold\"></span>\n                <button id=\"logout-btn\" class=\"ml-6 text-sm font-semibold text-red-600 hover:text-red-800\">Déconnexion <i class=\"fas fa-sign-out-alt ml-1\"></i></button>\n            </div>\n        </nav>\n    </header>\n\n    <!-- Main Content -->\n    <main class=\"container mx-auto px-6 py-8 flex-grow\">\n        <div id=\"loader\" class=\"text-center py-20\">\n            <i class=\"fas fa-spinner fa-spin text-4xl text-purple-600\"></i>\n            <p class=\"mt-4 text-gray-600\">Chargement de votre espace...</p>\n        </div>\n\n        <div id=\"dashboard-content\" class=\"hidden\">\n            \n            <!-- ADMIN DASHBOARD -->\n            <div id=\"admin-dashboard\" class=\"widget bg-gray-800 text-white\">\n                <h2 class=\"widget-title text-purple-400\"><i class=\"fas fa-user-shield mr-2\"></i> Panneau Administrateur</h2>\n                <div id=\"admin-content\" class=\"mt-4\"><p>Bienvenue, Administrateur. Vous avez les pleins pouvoirs.</p></div>\n            </div>\n\n            <!-- VENDOR/SELLER DASHBOARD -->\n            <div id=\"seller-dashboard\" class=\"widget\">\n                <h2 class=\"widget-title mb-4\"><i class=\"fas fa-store mr-2\"></i> Espace Vendeur</h2>\n                <div id=\"seller-content\"><a href=\"/add_product.html\" class=\"bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700\">Ajouter un nouveau produit</a></div>\n            </div>\n\n            <!-- AFFILIATE DASHBOARD -->\n            <div id=\"affiliate-dashboard\" class=\"widget\">\n                <h2 class=\"widget-title mb-4\"><i class=\"fas fa-link mr-2\"></i> Espace Affilié</h2>\n                <div id=\"affiliate-content\" class=\"space-y-3\"></div>\n            </div>\n\n        </div>\n    </main>\n\n    <!-- DIV pour le footer -->\n    <div id=\"footer-container\"></div>\n\n    <!-- DIV pour le widget Ney -->\n    <div id=\"ney-widget-container\"></div>\n\n    <script>\n      const firebaseConfig = {\n        apiKey: \"AIzaSyAt0NRbbszX8MSikgsYJngdmWzdfYLoBB0\",\n        authDomain: \"jeoahs1-max-03326376-49b27.firebaseapp.com\",\n        projectId: \"jeoahs1-max-03326376-49b27\",\n        storageBucket: \"jeoahs1-max-03326376-49b27.firebasestorage.app\",\n        messagingSenderId: \"893693678979\",\n        appId: \"1:893693678979:web:3243772acee2fde171d2b6\"\n      };\n\n      const app = firebase.initializeApp(firebaseConfig);\n      const auth = firebase.auth();\n      const db = firebase.firestore();\n\n      document.addEventListener(\'DOMContentLoaded\', () => {\n\n          fetch(\'/footer.html\').then(res => res.text()).then(data => document.getElementById(\'footer-container\').innerHTML = data);\n          fetch(\'/ney-widget.html\').then(res => res.text()).then(data => {\n              document.getElementById(\'ney-widget-container\').innerHTML = data;\n              const scriptEl = document.querySelector(\'#ney-widget-container script\');\n              if (scriptEl) {\n                  const newScript = document.createElement(\'script\');\n                  newScript.innerHTML = scriptEl.innerHTML;\n                  document.body.appendChild(newScript);\n              }\n          });\n\n          const loader = document.getElementById(\'loader\');\n          const dashboardContent = document.getElementById(\'dashboard-content\');\n          const userGreeting = document.getElementById(\'user-greeting\');\n          const logoutBtn = document.getElementById(\'logout-btn\');\n\n          auth.onAuthStateChanged(async (user) => {\n              if (user) {\n                  const userDocRef = db.collection(\"users\").doc(user.uid);\n                  const userDoc = await userDocRef.get();\n\n                  if (userDoc.exists()) {\n                      const userData = userDoc.data();\n                      userGreeting.textContent = `Bonjour, ${userData.fullname ? userData.fullname.split(\' \')[0] : \'Admin\'} !`;\n                      \n                      // FORCER L\'AFFICHAGE POUR L\'ADMIN\n                      setupAdminDashboard(user.uid, userData);\n                      setupSellerDashboard(user.uid, userData);\n                      setupAffiliateDashboard(user.uid, userData);\n\n                      loader.style.display = \'none\';\n                      dashboardContent.classList.remove(\'hidden\');\n\n                  } else {\n                      console.error(\"User data not found in Firestore.\");\n                      window.location.href = \'/register.html\';\n                  }\n              } else {\n                  window.location.href = \'/register.html\';\n              }\n          });\n\n          function setupAdminDashboard(userId, userData) {\n              document.getElementById(\'admin-dashboard\').style.display = \'block\';\n          }\n\n          function setupSellerDashboard(userId, userData) {\n              document.getElementById(\'seller-dashboard\').style.display = \'block\';\n          }\n\n          function setupAffiliateDashboard(userId, userData) {\n              const affiliateDashboard = document.getElementById(\'affiliate-dashboard\');\n              const affiliateContent = document.getElementById(\'affiliate-content\');\n              const links = userData.affiliateInfo?.externalLinks || [];\n              \n              let content = \'\';\n              if (links.length > 0) {\n                  content = \'<ul>\' + links.map(link => `<li class=\"truncate\"><i class=\"fas fa-link text-gray-400 mr-2\"></i><a href=\"${link}\" target=\"_blank\" class=\"text-blue-600 hover:underline\">${link}</a></li>`).join(\'\') + \'</ul>\';\n              } else {\n                  content = \'<p class=\"text-gray-500\">Aucun lien d\'affilié externe configuré.</p><a href=\"/onboarding_affiliate_external_links.html\" class=\"text-purple-600 hover:underline\">Commencez par ajouter vos liens</a>\';\n              }\n              affiliateContent.innerHTML = content;\n              affiliateDashboard.style.display = \'block\';\n          }\n\n          logoutBtn.addEventListener(\'click\', () => {\n              auth.signOut().then(() => {\n                  window.location.href = \'index.html\';\n              });\n          });\n      });\n    </script>\n</body>\n</html>\n