<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord - JEOAH'S</title>

    <!-- META SEO & OPEN GRAPH -->
    <meta name="robots" content="noindex, nofollow"> 

    <!-- Firebase SDK (Ancienne version pour compatibilité globale) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- Config & Styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="icon" href="/assets/logo.png" type="image/png">

    <!-- Script Multilingue -->
    <script>
        function setLang(l){ localStorage.setItem("lang", l); location.reload(); }
        const TEXT = { fr: { title: "Tableau de Bord" }, en: { title: "Dashboard" }, es: { title: "Panel de Control" } };
        const L = TEXT[ localStorage.getItem("lang") || "fr" ];
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .widget { background-color: white; border-radius: 1rem; box-shadow: 0 4px_6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); padding: 1.5rem; }
        .widget-title { font-size: 1.25rem; font-weight: 700; color: #1f2937; }
        #seller-dashboard, #affiliate-dashboard { display: none; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="flex items-center text-2xl font-extrabold text-gray-900">
                <img src="/assets/logo.png" alt="JEOAH'S Logo" class="h-8 mr-3">
                <span id="t-title"></span>
            </a>
            <div>
                <span id="user-greeting" class="text-gray-700 font-semibold"></span>
                <a href="/payment.html" class="ml-4 text-sm font-semibold text-purple-600 hover:text-purple-800"><i class="fas fa-credit-card mr-1"></i> Facturation</a>
                <button id="logout-btn" class="ml-6 text-sm font-semibold text-red-600 hover:text-red-800">Déconnexion <i class="fas fa-sign-out-alt ml-1"></i></button>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8 flex-grow">
        <div id="loader" class="text-center py-20">
            <i class="fas fa-spinner fa-spin text-4xl text-purple-600"></i>
            <p class="mt-4 text-gray-600">Chargement de votre espace...</p>
        </div>

        <div id="dashboard-content" class="hidden">
            <!-- VENDOR/SELLER DASHBOARD -->
            <div id="seller-dashboard">
                <div class="widget">
                    <h2 class="widget-title mb-4">Ajouter un nouveau produit</h2>
                    <form id="add-product-form" class="space-y-4">
                        <!-- ... (form content) ... -->
                    </form>
                </div>
            </div>

            <!-- AFFILIATE DASHBOARD -->
            <div id="affiliate-dashboard">
                <div class="widget">
                    <h2 class="widget-title mb-4">Vos Liens</h2>
                    <div id="links-display" class="space-y-3"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- DIV pour le footer -->
    <div id="footer-container"></div>

    <!-- DIV pour le widget Ney -->
    <div id="ney-widget-container"></div>

    <script>
      // ******************************************************
      // METTRE VOS CONFIGS FIREBASE ICI
      // ******************************************************
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
      };

      const app = firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();

      // ... (le reste du script du dashboard) ...

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('t-title').innerText = L.title;

            fetch('/footer.html').then(res => res.text()).then(data => document.getElementById('footer-container').innerHTML = data);
            fetch('/ney-widget.html').then(res => res.text()).then(data => {
                document.getElementById('ney-widget-container').innerHTML = data;
                const scriptEl = document.querySelector('#ney-widget-container script');
                if (scriptEl) {
                    const newScript = document.createElement('script');
                    newScript.innerHTML = scriptEl.innerHTML;
                    document.body.appendChild(newScript);
                }
            });

            // Le reste de la logique du dashboard...
            const loader = document.getElementById('loader');
            const dashboardContent = document.getElementById('dashboard-content');
            const userGreeting = document.getElementById('user-greeting');
            const logoutBtn = document.getElementById('logout-btn');

            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    const userDocRef = db.collection("users").doc(user.uid);
                    const userDoc = await userDocRef.get();

                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        const userRole = userData.role;
                        userGreeting.textContent = `Bonjour, ${userData.fullname.split(' ')[0]} !`;

                        if (userRole === 'vendeur') {
                            setupSellerDashboard(user.uid);
                        } else if (userRole === 'affilie') {
                            setupAffiliateDashboard(userData);
                        }

                        loader.style.display = 'none';
                        dashboardContent.style.display = 'block';
                    } else {
                        window.location.href = 'auth.html';
                    }
                } else {
                    window.location.href = 'auth.html';
                }
            });

            function setupSellerDashboard(userId) { /* ... */ }
            function setupAffiliateDashboard(userData) { /* ... */ }

            logoutBtn.addEventListener('click', () => {
                auth.signOut().then(() => {
                    window.location.href = 'index.html';
                });
            });
        });
    </script>
</body>
</html>